onsuccess: next_stage
debug: true
name: haileyxb/freeswitch
description: "Parse Freeswitch logs"
filter: evt.Parsed.program == 'freeswitch'
pattern_syntax:
  FS_TIMESTAMP: '202[1-2]-[0-1][0-9]-[0-1]\d \d\d:\d\d:\d\d.\d+'
  FS_EXTENSION: '\[[0-9a-zA-Z]+@[0-9a-zA-Z.]+\]'
nodes:
  - grok:
      pattern: ^%{FS_TIMESTAMP:timestamp} \[WARNING\]sofia_reg.c:1739 SIP auth failure (REGISTER) on sofia profile 'internal' for %{FS_EXTENSION:fs_exten} from ip %{IP:source_ip}$
      apply_on: message
  - grok:
      pattern: ^%{FS_TIMESTAMP:timestamp} \[WARNING\]sofia_reg.c:2930 Can't find user %{FS_EXTENSION:fs_exten} from %{IP:source_ip}$
      apply_on: message
statics:
  - meta: log_type
    value: freeswitch_failed_auth
  - meta: source_ip
    expression: "evt.Parsed.source_ip"
  - meta: exten
    expression: "evt.Parsed.fs_exten"
